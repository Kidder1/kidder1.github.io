<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    

    
<script>!function(){var e=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=localStorage.getItem("use-color-scheme")||"auto";("dark"===t||e&&"light"!==t)&&document.documentElement.classList.toggle("dark",!0)}()</script>
    

<meta charset="utf-8" >

<title>Crypto_CTF</title>
<meta name="keywords" content="Crypto_CTF, Kidder1&#39;s Blog!">
<meta name="description" content="Crypto刷题和知识点记录">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta property="og:title" content="Crypto_CTF">
<meta property="og:description" content="Crypto刷题和知识点记录">

<link rel="shortcut icon" href="/favicon.ico">
<link rel="stylesheet" href="/style/main.css">

  <link rel="stylesheet" href="/style/simple-lightbox.min.css"><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Kidder1's Blog!" type="application/atom+xml">
</head>
  <body>
    <div id="app" class="main">

<div class="site-header-container">
  <div class="site-header">
    <div class="left">
      <a href="https://kidder1.github.io">
        <img class="avatar" src="/images/avatar.png" alt="logo" width="32px" height="32px">
      </a>
      <a href="https://kidder1.github.io">
        <h1 class="site-title">Kidder1&#39;s Blog!</h1>
      </a>
    </div>
    <div class="right">
        <i class="icon menu-switch icon-menu-outline" ></i>
    </div>
  </div>
</div>

<div class="menu-container" style="height: 0;opacity: 0;">
<nav class="menu-list">
  
    
      <a href="/" class="menu purple-link">
        首页
      </a>
    
  
    
      <a href="/categories" class="menu purple-link">
        分类
      </a>
    
  
    
      <a href="/tags/" class="menu purple-link">
        标签
      </a>
    
  
    
      <a href="/archives" class="menu purple-link">
        归档
      </a>
    
  
    
      <a href="/about" class="menu purple-link">
        关于
      </a>
    
  
</nav>
</div>



  <div class="content-container">
    <div class="post-detail">
      
      <h2 class="post-title">Crypto_CTF</h2>
      <div class="post-info post-detail-info">
        <span><i class="icon icon-calendar-outline"></i> 2023-07-20</span>
        
          <span>
          <i class="icon icon-pricetags-outline"></i>
            
              <a href="/tags/Crypto/">
              Crypto
                
                  ，
                
              </a>
            
              <a href="/tags/Math/">
              Math
                
              </a>
            
          </span>
        
      </div>
      <div class="post-content-wrapper">
        <div class="post-content">
          <p>[TOC]</p>
<h1 id="HNCTF"><a href="#HNCTF" class="headerlink" title="HNCTF"></a>HNCTF</h1><h2 id="baBAbaseSEse（base家族）"><a href="#baBAbaseSEse（base家族）" class="headerlink" title="baBAbaseSEse（base家族）"></a>baBAbaseSEse（base家族）</h2><p>base家族 </p>
<ul>
<li><p>随波逐流梭哈</p>
<a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/image-20230720220320082.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/image-20230720220320082.png"  class="" lazyload></a>
</li>
<li><p>basecrack一把梭，windows我装不上，然后我就装到ubuntu了</p>
<a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/image-20230720224021152.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/image-20230720224021152.png"  class="" lazyload></a></li>
</ul>
<h2 id="babyRsa（基本RSA）"><a href="#babyRsa（基本RSA）" class="headerlink" title="babyRsa（基本RSA）"></a>babyRsa（基本RSA）</h2><p>基础知识</p>
<blockquote>
<p>注意：这里不能安装其他库，不然会因为版本问产生一系列的兼容性问题</p>
</blockquote>
<ol>
<li>PyCryptodome库主要由以下模块组成：</li>
</ol>
<ul>
<li><code>Crypto.Cipher</code>：包含对称加密算法，如AES、DES等。</li>
<li><code>Crypto.PublicKey</code>：包含非对称加密算法，如RSA、DSA等。</li>
<li><code>Crypto.Hash</code>：包含哈希函数，如SHA256、MD5等。</li>
<li><code>Crypto.Signature</code>：包含数字签名相关功能。</li>
<li><code>Crypto.Random</code>：提供随机数生成器。</li>
<li><code>Crypto.Protocol</code>：包含各种协议实现，如PBKDF2。</li>
<li><code>Crypto.Util</code>：包含一些实用工具，如填充、字节处理等</li>
</ul>
<ol start="2">
<li><p>对于RSA的一些工具</p>
<ul>
<li><p><strong>YAFU</strong>： YAFU（Yet Another Factoring Utility）是一个开源的用于整数因数分解的命令行工具。它是一个强大而灵活的工具，能够分解大整数为其质因数，有助于解决数论和密码学领域中的问题。YAFU是基于GMP（GNU多精度算法库）的，并使用了多种因数分解算法来优化分解过程。它是数学爱好者、密码学研究人员和密码分析者常用的工具之一</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1.使用 cmd 进入到 yafu 所在目录下，或将目录加入到系统环境 PATH 变量，或打开目录文件夹后 shift+右键 选择在此处打开 powershell </span><br><span class="line">2.假如要分解因数 6 ，输入命令：.\yafu-x64.exe &quot;factor(6)&quot;</span><br><span class="line">3.如果因数过长，将 因数 用文本文件存放在 yafu 目录下，例如：data.txt 。文件最后一行一定要换行，否则eof; done processing batchfile。 运行命令：.\yafu-x64.exe &quot;factor(@)&quot; -batchfile data.txt</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>FactorDB</strong>： FactorDB是一个在线的整数因数分解数据库。它允许用户将大整数提交到数据库，并查找其质因数分解。这个数据库是由全球用户提交的整数分解结果共同维护的，它采用了多种现代算法来分解整数。FactorDB 对于那些没有自己的因数分解工具或想要验证分解结果的用户来说是非常有用的。通过FactorDB，用户可以快速地找到一个整数的质因数，而无需自行进行因数分解运算 网站<a target="_blank" rel="noopener" href="http://www.factordb.com/">factordb.com</a></p>
</li>
</ul>
<p>这个题是一个简单的RSA</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"><span class="comment"># 这里我们导入了bytes_to_long函数，它用于将字节转换为长整数（将flag转换为m），以及导入了getPrime函数，它用于生成指定位数的随机素数。</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">P39 = <span class="number">265147241000574873803071047177766359643</span></span><br><span class="line">P39 = <span class="number">234560843346150602519484260867514743467</span></span><br><span class="line">q = getPrime(<span class="number">128</span>)</span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line"><span class="comment"># 这两行代码使用getPrime(128)函数生成两个128位的随机素数，并将它们赋值给变量p和q。在RSA加密中，p 和 q 是用于计算 RSA 公钥和私钥的重要参数。</span></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">17331436837911040930486942133359735652484926528331507431552667656734821231501</span></span><br><span class="line"><span class="comment"># n 是RSA的模数，它是两个素数 p 和 q 的乘积。</span></span><br><span class="line"><span class="comment"># e 是RSA的公钥指数，通常为固定值 65537（也称为常用的 RSA 公钥指数）。</span></span><br><span class="line"><span class="comment"># c 是RSA的密文，通过用公钥指数 e 对明文 m 进行模幂运算得到。</span></span><br><span class="line"><span class="built_in">print</span>(n,c)</span><br><span class="line"><span class="comment"># 62193160459999883112594854240161159254035770172137079047232757011759606702281</span></span><br><span class="line"><span class="comment"># 17331436837911040930486942133359735652484926528331507431552667656734821231501</span></span><br></pre></td></tr></table></figure>

<p>通过上述工具进行分解之后，然后写出对应的解密脚本即可，这里主要是了解了这些库的一些基本使用而已</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">计算 RSA 私钥参数：</span><br><span class="line">使用已知的 p 和 q 计算了模数 n，并通过调用 invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)) 函数计算得到私钥指数 d。</span><br><span class="line">RSA 解密并输出明文：</span><br><span class="line">使用得到的私钥指数 d 和模数 n，将密文 c 进行 RSA 解密，并通过 long_to_bytes 函数将解密后的长整数转换为明文，并进行输出。</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">p = <span class="number">234560843346150602519484260867514743467</span></span><br><span class="line">q = <span class="number">265147241000574873803071047177766359643</span></span><br><span class="line">c = <span class="number">17331436837911040930486942133359735652484926528331507431552667656734821231501</span></span><br><span class="line">n = p * q</span><br><span class="line">d = invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c,d,n)))</span><br></pre></td></tr></table></figure>

<p>然后安装了sage的软件，还没有使用，明天再看看吧！</p>
</li>
</ol>
<h2 id="A-dictator（凯撒密码）"><a href="#A-dictator（凯撒密码）" class="headerlink" title="A dictator（凯撒密码）"></a>A dictator（凯撒密码）</h2><p>凯撒密码就是根据偏移移位的密码</p>
<p>加密过程</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="comment"># # 用于生成一个在范围 [1, 100] 内的随机整数，并将其对 26 取模，以确保得到的偏移量在 0 到 25 之间</span></span><br><span class="line">offset = randint(<span class="number">1</span>,<span class="number">100</span>) % <span class="number">26</span></span><br><span class="line"><span class="built_in">print</span>(offset)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">&#x27;NSSCTF&#123;&#x27;</span>)</span><br><span class="line"><span class="comment"># 确保flag字符串中除去前7个字符和最后一个字符的部分，所有字符都不是大写字母</span></span><br><span class="line"><span class="keyword">assert</span> <span class="built_in">all</span>([<span class="built_in">ord</span>(c) <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>),<span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>)) <span class="keyword">for</span> c <span class="keyword">in</span> flag[<span class="number">7</span>:-<span class="number">1</span>]])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> char <span class="keyword">in</span> flag[<span class="number">7</span>:-<span class="number">1</span>]:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= <span class="built_in">ord</span>(char) &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">        <span class="comment"># 小写字母计算偏移量</span></span><br><span class="line">        index = <span class="built_in">ord</span>(char)-<span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">        <span class="comment"># 计算新的字符</span></span><br><span class="line">        new_char = <span class="built_in">chr</span>((index+offset)%<span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">        <span class="built_in">print</span>(new_char,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(char,end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="comment"># 密文</span></span><br><span class="line"><span class="comment"># cipher = &#x27;nby_wuymul_wcjbyl_cm_ihy_iz_nby_gimn_vumcw_wfummcwuf_wcjbylm&#x27;</span></span><br></pre></td></tr></table></figure>

<p>解密过程：这个加密解密完都是小写字母，通过25个随机数字进行爆破解密即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cipher = <span class="string">&#x27;nby_wuymul_wcjbyl_cm_ihy_iz_nby_gimn_vumcw_wfummcwuf_wcjbylm&#x27;</span></span><br><span class="line"><span class="comment"># 从0-25遍历</span></span><br><span class="line"><span class="keyword">for</span> offset <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    <span class="built_in">print</span>()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= <span class="built_in">ord</span>(i) &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">            index = <span class="built_in">ord</span>(i) - <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">            new_char = <span class="built_in">chr</span>((index + offset) % <span class="number">26</span> + <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>))</span><br><span class="line">            <span class="built_in">print</span>(new_char, end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(i, end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>官方wp有一个string的库，这里学习了一下</p>
<blockquote>
<p><strong>问：from string import ascii_lowercase  string库是什么库？</strong></p>
<p><strong>答：在Python中，<code>string</code> 是一个标准库，它包含了许多与字符串处理相关的常用常量和函数。通过导入 <code>string</code> 库，你可以使用其中定义的常量和函数，而不需要自己定义相同的内容。</strong></p>
<p><strong>在给定的代码中，使用 <code>from string import ascii_lowercase</code> 导入了 <code>string</code> 标准库中的 <code>ascii_lowercase</code> 常量。<code>ascii_lowercase</code> 是一个包含所有小写字母的字符串，它的值为 <code>&#39;abcdefghijklmnopqrstuvwxyz&#39;</code>。这样一来，代码就可以直接使用 <code>ascii_lowercase</code> 变量来表示小写字母表，而不需要手动定义这个字符串。</strong></p>
</blockquote>
<h2 id="爱妃（仿射密码）"><a href="#爱妃（仿射密码）" class="headerlink" title="爱妃（仿射密码）"></a>爱妃（仿射密码）</h2><p>放射密码（Affine Cipher）是一种古典密码学中的替换密码，它对字母表中的字符进行加密和解密。放射密码的数学原理涉及到仿射函数的应用。</p>
<p>放射函数的一般形式为：E(x) &#x3D; (ax + b) mod m</p>
<p>其中：</p>
<ul>
<li>E(x) 表示密文字符；</li>
<li>x 表示明文字符；</li>
<li>a 和 b 是整数，并且满足 a 和 m 互质（最大公约数为1）；</li>
<li>mod m 表示对 m 取模，即结果在 0 到 (m-1) 的范围内。</li>
</ul>
<p>在放射密码中，每个明文字符 x 被映射为一个密文字符 E(x)。参数 a 和 b 是放射函数的密钥，通过正确选择这些密钥，可以实现有效的加密和解密。</p>
<p>解密过程是对密文字符应用逆放射函数：D(y) &#x3D; a^(-1) * (y - b) mod m，其中 a^(-1) 表示 a 的乘法逆元素。</p>
<a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/image-20230722180423532.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/image-20230722180423532.png"  class="" lazyload></a>

<a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/image-20230722181454094.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/image-20230722181454094.png"  class="" lazyload></a>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">cipher, a_invert, b, m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([a_invert*(i   - b) % m <span class="keyword">for</span> i <span class="keyword">in</span> cipher])</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">message, a, b, m</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([(<span class="built_in">ord</span>(i) * a + b) % m <span class="keyword">for</span> i <span class="keyword">in</span> message])</span><br><span class="line"></span><br><span class="line">c = <span class="string">b&#x27;y\xba\xba\xea\xc7\x11\xc2\xc7\xcb\xd8ZV\xd8ZVp\xb1\xb1\xd8\x19\xa4V\xa4\x19\x8aM\xa83g\xd8&amp;\x19\xdc&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;NSSCTF&#123;&#x27;</span></span><br><span class="line"><span class="comment"># 计算密钥a，b</span></span><br><span class="line"><span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">if</span> encrypt(flag, a, b, m) <span class="keyword">in</span> c:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"> 			<span class="comment"># print(a, b)</span></span><br><span class="line">m = <span class="number">1</span> &lt;&lt; <span class="number">8</span></span><br><span class="line">a = <span class="number">13</span> </span><br><span class="line">b = <span class="number">131</span></span><br><span class="line"><span class="comment"># 计算a的逆元函数</span></span><br><span class="line">a_invert = gmpy2.invert(<span class="number">13</span>,<span class="number">256</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;a_invert = &#x27;</span>, a_invert)</span><br><span class="line">m = decrypt(c,a_invert,b,m)</span><br><span class="line"><span class="built_in">print</span>(m.decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">str</span>(m))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="littleprince-同余方程，中国剩余定理"><a href="#littleprince-同余方程，中国剩余定理" class="headerlink" title="littleprince(同余方程，中国剩余定理)"></a>littleprince(同余方程，中国剩余定理)</h2><p>这道题的给的加密代码有一些难理解，在这里记录一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">a, b, c</span>):</span><br><span class="line">  	<span class="comment"># 1 &lt;&lt; b 表示将数字 1 左移 b 位，即得到一个只有第 b 位为1，其余位都为0的整数</span></span><br><span class="line">    <span class="comment"># 例如，如果 b 等于 3，那么 1 &lt;&lt; b 就等于二进制数 0b1000，也就是十进制数 8	</span></span><br><span class="line">	<span class="comment"># 对结果 1 &lt;&lt; b 减去 1，这样得到的二进制数将会是从第 0 位到第 b-1 位都是1，其余位都是0</span></span><br><span class="line">	<span class="comment"># 以 b 等于 3 为例，((1 &lt;&lt; 3) - 1) 将得到二进制数 0b111，也就是十进制数 7</span></span><br><span class="line">	<span class="comment"># 最后，我们将 a 和上述得到的结果进行按位与操作 &amp;，这样就会保留 a 的低 b 位，将其余高位都置为0</span></span><br><span class="line">    <span class="comment"># a的低b位的掩码在这里保留a的最后b位置，其他位置设为0</span></span><br><span class="line">    <span class="comment"># 它将这两个结果进行位或操作 | 并将低 c - b 位左移</span></span><br><span class="line">    <span class="comment"># 目的是对a进行加密并且返回</span></span><br><span class="line">    <span class="keyword">return</span> a &gt;&gt; b | (a &amp; ((<span class="number">1</span> &lt;&lt; b)-<span class="number">1</span>)) &lt;&lt; (c-b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">outp</span>(<span class="params">x, h</span>):</span><br><span class="line">    p = randint(<span class="number">1</span> &lt;&lt; h, <span class="number">1</span> &lt;&lt; h+<span class="number">1</span>)</span><br><span class="line">    q = randint(<span class="number">1</span> &lt;&lt; h, <span class="number">1</span> &lt;&lt; h+<span class="number">1</span>)</span><br><span class="line">    c1, c2 = x % p, x % q</span><br><span class="line">    <span class="built_in">print</span>(p, q, c1, c2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag 转成长整数m</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line"><span class="comment"># 计算m的二进制位数</span></span><br><span class="line">m_len = m.bit_length()</span><br><span class="line">d, h, st = <span class="number">32</span>, <span class="number">16</span>, <span class="number">32</span></span><br><span class="line">r = m_len % d</span><br><span class="line"><span class="keyword">assert</span> (r &gt; h)</span><br><span class="line"><span class="keyword">while</span> st &lt;= m_len:</span><br><span class="line">    <span class="comment"># 对m进行加密</span></span><br><span class="line">    x = enc(m, st, m_len)</span><br><span class="line">    x &gt;&gt;= (m_len-d)</span><br><span class="line">    <span class="comment"># 输出加密结果</span></span><br><span class="line">    outp(x, h)</span><br><span class="line">    st += d</span><br><span class="line"><span class="comment"># 对 m 进行额外的加密操作，并通过 outp 函数输出最终的加密结果</span></span><br><span class="line">m &gt;&gt;= (m_len-r)</span><br><span class="line">outp(m, h)</span><br></pre></td></tr></table></figure>

<h3 id="掩码"><a href="#掩码" class="headerlink" title="掩码"></a>掩码</h3><blockquote>
<p>在计算机科学中，”掩码”（Mask）是一个用于屏蔽或提取某些位的二进制模式。掩码通常是一个与目标数据进行按位与操作的值，通过这种操作，可以将目标数据的某些位设置为0或从中提取出感兴趣的位。</p>
<p>掩码在计算机编程和计算机系统中有广泛的应用，主要用于以下两个方面：</p>
<ol>
<li>屏蔽位：掩码可以用于屏蔽目标数据的特定位。通过将目标数据与相应的掩码进行按位与操作，可以将不需要的位设置为0，而保留需要的位。这在编程中常用于清除或保留特定标志位，或者过滤掉数据中不需要的部分。</li>
<li>提取位：掩码还可以用于从目标数据中提取出感兴趣的位。通过将目标数据与相应的掩码进行按位与操作，可以将目标数据的其他位设置为0，而保留感兴趣的位。这在计算机系统中常用于从寄存器或数据中提取出特定字段或标志位。</li>
</ol>
<p>掩码通常使用二进制形式表示，并且每个位都对应于目标数据的相应位。在掩码中，1 表示需要保留或提取的位，0 表示需要屏蔽的位。</p>
<p>例如，对于目标数据 <code>11010110</code>，如果我们希望屏蔽掉低三位，我们可以使用掩码 <code>11111000</code>，通过进行按位与操作，结果将是 <code>11010000</code>。同样，如果我们希望提取低四位，我们可以使用掩码 <code>00001111</code>，通过进行按位与操作，结果将是 <code>00000110</code>。</p>
<ul>
<li>总结：与运算取出感兴趣的位，感兴趣为1，不感兴趣为0</li>
</ul>
</blockquote>
<h3 id="关于移位"><a href="#关于移位" class="headerlink" title="关于移位"></a>关于移位</h3><blockquote>
<p>a &gt;&gt; b | (a &amp; ((1 &lt;&lt; b)-1)) &lt;&lt; (c-b)</p>
<p>假设 <code>a</code> 等于 87 （二进制：<code>0b1010111</code>），<code>b</code> 等于 4。</p>
<ol>
<li><code>1 &lt;&lt; b</code> 的结果为 <code>0b10000</code>，也就是十进制数 16。</li>
<li><code>((1 &lt;&lt; b) - 1)</code> 的结果为 <code>0b1111</code>，也就是十进制数 15。</li>
<li><code>a &amp; ((1 &lt;&lt; b) - 1)</code> 就是 <code>0b1010111 &amp; 0b1111</code>，结果为 <code>0b111</code>，也就是十进制数 7。</li>
</ol>
<p>所以，<code>(a &amp; ((1 &lt;&lt; b) - 1))</code> 表达式的结果就是 <code>a</code> 的低 <code>b</code> 位的掩码，它将保留 <code>a</code> 二进制表示中的最后 <code>b</code> 位，并将其他位设置为0。</p>
</blockquote>
<h1 id="RSA系列"><a href="#RSA系列" class="headerlink" title="RSA系列"></a>RSA系列</h1><h2 id="RSA原理"><a href="#RSA原理" class="headerlink" title="RSA原理"></a>RSA原理</h2><p>生成数字</p>
<a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/image-20230724151309040.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/image-20230724151309040.png"  class="" lazyload></a>

<p>加密与解密</p>
<a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/image-20230724151346417.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/image-20230724151346417.png"  class="" lazyload></a>

<h2 id="RSA-Py代码实现"><a href="#RSA-Py代码实现" class="headerlink" title="RSA Py代码实现"></a>RSA Py代码实现</h2><p>Python代码的计算过程</p>
<ol>
<li><p>导入子库生成两个大素数，512bit朝</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># getPrime函数，它能够返回一个n位的素数</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(q)</span><br></pre></td></tr></table></figure>
</li>
<li><p>计算欧拉函数和n</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>选取e判断互素性，并且计算逆元</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e = 65537</span><br><span class="line">assert GCD(e, phi) == 1, &quot;该e不满足互素条件&quot;</span><br><span class="line">d = inverse(e, phi)</span><br></pre></td></tr></table></figure>
</li>
<li><p>加密hello</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里定义的是byte类型的字符串，每个字符用8位的二进制进行存储，如果直接定义字符串hello，字符串类型需要进行编码字节类型才可以进行加密</span></span><br><span class="line">message = <span class="string">b&#x27;hello&#x27;</span></span><br><span class="line"><span class="comment"># 使用的bytes_to_long函数，将字符串转换为数字</span></span><br><span class="line">m = bytes_to_long(message)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"><span class="comment"># 消息已经被转换为一个字符串了，可以加密</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line">msg = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(msg)</span><br></pre></td></tr></table></figure>
</li>
<li><p>完整代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line"></span><br><span class="line">n = p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="keyword">assert</span> GCD(e, phi) == <span class="number">1</span>, <span class="string">&quot;该e不满足互素条件&quot;</span></span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;公钥：(<span class="subst">&#123;e&#125;</span>, <span class="subst">&#123;n&#125;</span>)&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;私钥：(<span class="subst">&#123;d&#125;</span>, <span class="subst">&#123;n&#125;</span>)&#x27;</span>)</span><br><span class="line"></span><br><span class="line">message = <span class="string">b&#x27;hello&#x27;</span></span><br><span class="line">m = bytes_to_long(message)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;消息：&#x27;</span>, m)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;密文：&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line">msg = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;明文：&#x27;</span>, msg)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> msg == m, <span class="string">&quot;解密失败&quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="RSA类型"><a href="#RSA类型" class="headerlink" title="RSA类型"></a>RSA类型</h2><h3 id="p-q过小差值小类型"><a href="#p-q过小差值小类型" class="headerlink" title="p-q过小差值小类型"></a>p-q过小差值小类型</h3><p>题目代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">flag = <span class="string">b&#x27;NSSCTF&#123;******&#125;&#x27;</span></span><br><span class="line"><span class="comment"># 特征</span></span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = gmpy2.next_prime(p)</span><br><span class="line">n = p*q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>这里一个特征就是，p通过函数生成512位的素数，然后q为其相邻的下一个素数，可以进行测试</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = gmpy2.next_prime(p)</span><br><span class="line"><span class="built_in">print</span>(q-p)</span><br></pre></td></tr></table></figure>

<p>解题原理</p>
<a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/image-20230801080504699.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/image-20230801080504699.png"  class="" lazyload></a>

<p>代码</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">n =</span><br><span class="line">e = </span><br><span class="line">c = </span><br><span class="line">sn = gmpy2.isqrt(n)</span><br><span class="line">q = gmpy2.next_prime(sn)</span><br><span class="line">p = n // q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = gmpy2.invert(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<h3 id="费马分解"><a href="#费马分解" class="headerlink" title="费马分解"></a>费马分解</h3><h1 id="对称密码系列"><a href="#对称密码系列" class="headerlink" title="对称密码系列"></a>对称密码系列</h1><p>定义：对称加密，称为对称密码,是指在加密和解密时使用同一密钥得加密方式。</p>
<p>特点：比非对称加密要快</p>
<h2 id="DES"><a href="#DES" class="headerlink" title="DES"></a>DES</h2><p>典型的块加密，将明文分块加密</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><p>在DES中，具有如下特点</p>
<ol>
<li>输入<code>64</code>位。</li>
<li>输出<code>64</code>位。</li>
<li>密钥<code>64</code>位，使用<code>64</code>位密钥中的<code>56</code>位，剩余的<code>8</code>位要么丢弃，要么作为奇偶校验位。</li>
<li>采用Feistel迭代结构：<ol>
<li>明文经过 16 轮迭代得到密文。</li>
<li>密文经过类似的 16 轮迭代得到明文</li>
</ol>
</li>
</ol>
<h3 id="加密过程"><a href="#加密过程" class="headerlink" title="加密过程"></a>加密过程</h3><h4 id="初始置换"><a href="#初始置换" class="headerlink" title="初始置换"></a>初始置换</h4><ul>
<li>64位明文分组<strong>X</strong>经过一个初始置换函数<code>IP</code>，产生64位的输出<strong>X0</strong>，再将分组<strong><em>X</em>0</strong>分成左半部分<em>L</em>0和右半部分<strong><em>R</em>0</strong>。<ol>
<li>将输入的第58位换到第一位，第50位换到第2位，…，依次类推。</li>
<li><em>L</em>0、<em>R</em>0则是换位输出后的两部分， <em>L</em>0是输出的左32位， <em>R</em>0是右32位。</li>
</ol>
</li>
<li>简而言之，这就是打乱了明文之间的排列，我们使用Python来实现这个函数，在这里及后续的代码中，我们都将明文认为是一个数字数组进行操作。</li>
</ul>
<h4 id="获取子密钥"><a href="#获取子密钥" class="headerlink" title="获取子密钥"></a>获取子密钥</h4><ul>
<li>在进入第一轮之前，我们还需要对密钥进行处理生成子密钥，每一轮将使用不同的子密钥参与运算。DES加密算法的密钥长度为56位，一般表示为<code>64</code>位(每个第<code>8</code>位用于奇偶校验)，将用户提供的<code>64</code>位初始密钥经过一系列的处理得到K1,K2,…,K16，分别作为1~16轮运算的16个子密钥。<ol>
<li>将64位密钥去掉8个校验位，用密钥置换PC-1置换身下的56位密钥</li>
<li>将56位分成前28位和后28位</li>
<li>根据轮数，将这两部分别循环左移1位或2位</li>
<li>移动后，将两部分合成56位后压缩置换PC-2后得到48位子密钥</li>
</ol>
</li>
</ul>
<h4 id="密码函数F"><a href="#密码函数F" class="headerlink" title="密码函数F"></a>密码函数F</h4><ul>
<li>密码函数F的作用是将输入的32比特数据和48比特子密钥进行加密输出32比特<br>扩展置换E：将数据的右半部分<code>Ri</code>从32位扩展为48位。位选择函数(也称E盒)。<br>异或：扩展后的48位输出<code>E(Ri)</code>与压缩后的48位密钥Ki作异或运算；<br>S盒替换：将异或得到的48位结果分成八个6位的块，每一块通过对应的一个S盒产生一个4位的输出。<br>P盒置换：将S盒得到的输出再和<code>P</code>盒进行置换操作。</li>
</ul>
<h3 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> add</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="comment"># operator这个库提供了一组函数，用于执行Python内置运算符的操作。它允许您以函数的形式使用像加法、减法、乘法等运算符，从而使您能够以更灵活的方式操作数据。例如，add()函数允许您将两个数字相加，而不是使用+运算符</span></span><br><span class="line"><span class="comment"># typing提供了在Python中进行类型提示(type hinting)的功能。允许开发者在函数参数、返回值和变量上添加类型注释。</span></span><br><span class="line"><span class="comment"># 这个库提供了一些函数式编程工具，它们可以让您更轻松地处理函数和操作。其中最常用的函数是reduce()，它可以对一个序列中的元素应用某个二元函数，并返回一个最终的聚合结果</span></span><br><span class="line">_IP = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>,  <span class="number">1</span>,</span><br><span class="line">	<span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">	<span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">	<span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>,</span><br><span class="line">	<span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,  <span class="number">0</span>,</span><br><span class="line">	<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">	<span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">	<span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># 这里的plain：List[int]是类型注释，代表plain的参数应该是一个整数列表 但注意，这只是一种提示，并不是强制执行这些类型</span></span><br><span class="line"><span class="comment"># map用于可迭代对象中每个元素给定的函数</span></span><br><span class="line"><span class="comment"># lambda 匿名函数 参数x，返回plain[x]</span></span><br><span class="line"><span class="comment"># 函数功能介绍，将_IP中每个元素作为索引x获取plain[x] </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">IP</span>(<span class="params">plain: <span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: plain[x], _IP))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取子密钥</span></span><br><span class="line"><span class="comment"># 置换56位密钥的pc-1置换表</span></span><br><span class="line">__pc1 = [<span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>,  <span class="number">8</span>,</span><br><span class="line">	  <span class="number">0</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>,</span><br><span class="line">	  <span class="number">9</span>,  <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>,</span><br><span class="line">	 <span class="number">18</span>, <span class="number">10</span>,  <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>,</span><br><span class="line">	 <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>,</span><br><span class="line">	  <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>,</span><br><span class="line">	 <span class="number">13</span>,  <span class="number">5</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>,</span><br><span class="line">	 <span class="number">20</span>, <span class="number">12</span>,  <span class="number">4</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>,  <span class="number">3</span></span><br><span class="line">]</span><br><span class="line"><span class="comment"># 移动后合并56位压缩置换pc-2置换表</span></span><br><span class="line">__pc2 = [</span><br><span class="line">	<span class="number">13</span>, <span class="number">16</span>, <span class="number">10</span>, <span class="number">23</span>,  <span class="number">0</span>,  <span class="number">4</span>,</span><br><span class="line">	 <span class="number">2</span>, <span class="number">27</span>, <span class="number">14</span>,  <span class="number">5</span>, <span class="number">20</span>,  <span class="number">9</span>,</span><br><span class="line">	<span class="number">22</span>, <span class="number">18</span>, <span class="number">11</span>,  <span class="number">3</span>, <span class="number">25</span>,  <span class="number">7</span>,</span><br><span class="line">	<span class="number">15</span>,  <span class="number">6</span>, <span class="number">26</span>, <span class="number">19</span>, <span class="number">12</span>,  <span class="number">1</span>,</span><br><span class="line">	<span class="number">40</span>, <span class="number">51</span>, <span class="number">30</span>, <span class="number">36</span>, <span class="number">46</span>, <span class="number">54</span>,</span><br><span class="line">	<span class="number">29</span>, <span class="number">39</span>, <span class="number">50</span>, <span class="number">44</span>, <span class="number">32</span>, <span class="number">47</span>,</span><br><span class="line">	<span class="number">43</span>, <span class="number">48</span>, <span class="number">38</span>, <span class="number">55</span>, <span class="number">33</span>, <span class="number">52</span>,</span><br><span class="line">	<span class="number">45</span>, <span class="number">41</span>, <span class="number">49</span>, <span class="number">35</span>, <span class="number">28</span>, <span class="number">31</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环左移轮数对应于1位或2位</span></span><br><span class="line">ROTATIONS = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># PC_1置换函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PC_1</span>(<span class="params">key: <span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: key[x], __pc1))</span><br><span class="line"></span><br><span class="line"><span class="comment"># PC_2置换函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PC_2</span>(<span class="params">key: <span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: key[x], __pc2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取子钥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_sub_key</span>(<span class="params">key: <span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    key = PC_1(key) <span class="comment"># PC-1置换</span></span><br><span class="line">    L, R = key[:<span class="number">28</span>], key[<span class="number">28</span>:] <span class="comment"># 分成两半</span></span><br><span class="line"></span><br><span class="line">    skeys = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(ROTATIONS[i]): <span class="comment"># 根据轮次左移</span></span><br><span class="line">            L = L[<span class="number">1</span>:] + L[:<span class="number">1</span>]</span><br><span class="line">            R = R[<span class="number">1</span>:] + R[:<span class="number">1</span>]</span><br><span class="line">        skeys.append(PC_2(L+R)) <span class="comment"># PC-2置换</span></span><br><span class="line">    <span class="keyword">return</span> skeys</span><br><span class="line"></span><br><span class="line">__expansion_table = [</span><br><span class="line">	<span class="number">31</span>,  <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>,  <span class="number">3</span>,  <span class="number">4</span>,</span><br><span class="line">	 <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>,  <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>,</span><br><span class="line">	 <span class="number">7</span>,  <span class="number">8</span>,  <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>,</span><br><span class="line">	<span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>,</span><br><span class="line">	<span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>,</span><br><span class="line">	<span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>,</span><br><span class="line">	<span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>,</span><br><span class="line">	<span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>,  <span class="number">0</span></span><br><span class="line">]</span><br><span class="line">__sbox = [</span><br><span class="line">		<span class="comment"># S1</span></span><br><span class="line">		[<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>,</span><br><span class="line">		 <span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line">		 <span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>,</span><br><span class="line">		 <span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>],</span><br><span class="line"></span><br><span class="line">		<span class="comment"># S2</span></span><br><span class="line">		[<span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>,</span><br><span class="line">		 <span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>,</span><br><span class="line">		 <span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>,</span><br><span class="line">		 <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line"></span><br><span class="line">		<span class="comment"># S3</span></span><br><span class="line">		[<span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>,</span><br><span class="line">		 <span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>,</span><br><span class="line">		 <span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>,</span><br><span class="line">		 <span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>],</span><br><span class="line"></span><br><span class="line">		<span class="comment"># S4</span></span><br><span class="line">		[<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>,</span><br><span class="line">		 <span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">		 <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>,</span><br><span class="line">		 <span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>],</span><br><span class="line"></span><br><span class="line">		<span class="comment"># S5</span></span><br><span class="line">		[<span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>,</span><br><span class="line">		 <span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>,</span><br><span class="line">		 <span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>,</span><br><span class="line">		 <span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>],</span><br><span class="line"></span><br><span class="line">		<span class="comment"># S6</span></span><br><span class="line">		[<span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>,</span><br><span class="line">		 <span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>,</span><br><span class="line">		 <span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>,</span><br><span class="line">		 <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>],</span><br><span class="line"></span><br><span class="line">		<span class="comment"># S7</span></span><br><span class="line">		[<span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>,</span><br><span class="line">		 <span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>,</span><br><span class="line">		 <span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>,</span><br><span class="line">		 <span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>],</span><br><span class="line"></span><br><span class="line">		<span class="comment"># S8</span></span><br><span class="line">		[<span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>,</span><br><span class="line">		 <span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>,</span><br><span class="line">		 <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>,</span><br><span class="line">		 <span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>],</span><br><span class="line">	]</span><br><span class="line">__p = [</span><br><span class="line">	<span class="number">15</span>, <span class="number">6</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">28</span>, <span class="number">11</span>,</span><br><span class="line">	<span class="number">27</span>, <span class="number">16</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">22</span>, <span class="number">25</span>,</span><br><span class="line">	<span class="number">4</span>, <span class="number">17</span>, <span class="number">30</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>,</span><br><span class="line">	<span class="number">23</span>,<span class="number">13</span>, <span class="number">31</span>, <span class="number">26</span>, <span class="number">2</span>, <span class="number">8</span>,</span><br><span class="line">	<span class="number">18</span>, <span class="number">12</span>, <span class="number">29</span>, <span class="number">5</span>, <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line">	<span class="number">3</span>, <span class="number">24</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">EP</span>(<span class="params">data: <span class="type">List</span>[<span class="built_in">int</span>]</span>):  <span class="comment"># 扩展置换</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: data[x], __expansion_table))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>(<span class="params">data: <span class="type">List</span>[<span class="built_in">int</span>]</span>):  <span class="comment"># P置换</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: data[x], __p))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">F</span>(<span class="params">index: <span class="built_in">int</span>, R: <span class="type">List</span>[<span class="built_in">int</span>], skeys: <span class="type">List</span>[<span class="type">List</span>[<span class="built_in">int</span>]]</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    index: 代表这是第几轮</span></span><br><span class="line"><span class="string">    R: 输入数据</span></span><br><span class="line"><span class="string">    skeys: 子密钥数组</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="comment"># 右半部分扩展成48位</span></span><br><span class="line">    R = EP(R)  <span class="comment"># 扩展置换</span></span><br><span class="line">    R = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x, y: x ^ y, R, skeys[index]))  <span class="comment"># 异或</span></span><br><span class="line"></span><br><span class="line">    B = [R[:<span class="number">6</span>], R[<span class="number">6</span>:<span class="number">12</span>], R[<span class="number">12</span>:<span class="number">18</span>], R[<span class="number">18</span>:<span class="number">24</span>], R[<span class="number">24</span>:<span class="number">30</span>], R[<span class="number">30</span>:<span class="number">36</span>], R[<span class="number">36</span>:<span class="number">42</span>], R[<span class="number">42</span>:]]  <span class="comment"># 分成八份</span></span><br><span class="line"></span><br><span class="line">    Bn = [<span class="number">0</span>] * <span class="number">32</span></span><br><span class="line">    pos = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="comment">#  计算该使用S盒的行坐标和列坐标</span></span><br><span class="line">        row = (B[i][<span class="number">0</span>] &lt;&lt; <span class="number">1</span>) + B[i][<span class="number">5</span>]</span><br><span class="line">        col = (B[i][<span class="number">1</span>] &lt;&lt; <span class="number">3</span>) + (B[i][<span class="number">2</span>] &lt;&lt; <span class="number">2</span>) + (B[i][<span class="number">3</span>] &lt;&lt; <span class="number">1</span>) + B[i][<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">        sb = __sbox[i][(row &lt;&lt; <span class="number">4</span>) + col]</span><br><span class="line"></span><br><span class="line">        Bn[pos + <span class="number">0</span>] = (sb &amp; <span class="number">8</span>) &gt;&gt; <span class="number">3</span>  <span class="comment"># 四位输出</span></span><br><span class="line">        Bn[pos + <span class="number">1</span>] = (sb &amp; <span class="number">4</span>) &gt;&gt; <span class="number">2</span></span><br><span class="line">        Bn[pos + <span class="number">2</span>] = (sb &amp; <span class="number">2</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">        Bn[pos + <span class="number">3</span>] = (sb &amp; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">        pos += <span class="number">4</span></span><br><span class="line">    R = P(Bn)</span><br><span class="line">    <span class="keyword">return</span> R</span><br><span class="line"></span><br><span class="line">_FP = [</span><br><span class="line">	<span class="number">39</span>,  <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">	<span class="number">38</span>,  <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">	<span class="number">37</span>,  <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">	<span class="number">36</span>,  <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">	<span class="number">35</span>,  <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">	<span class="number">34</span>,  <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">	<span class="number">33</span>,  <span class="number">1</span>, <span class="number">41</span>,  <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>,</span><br><span class="line">	<span class="number">32</span>,  <span class="number">0</span>, <span class="number">40</span>,  <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 逆置换，相对于初始置换的逆操作，将数据放回原位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FP</span>(<span class="params">plain: <span class="type">List</span>[<span class="built_in">int</span>]</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x: plain[x], _FP))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;12345678&#x27;</span></span><br><span class="line">plain = <span class="string">b&#x27;12345678&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转为二进制数组</span></span><br><span class="line">key = reduce(add, [<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>))) <span class="keyword">for</span> i <span class="keyword">in</span> key])</span><br><span class="line">plain = reduce(add, [<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>))) <span class="keyword">for</span> i <span class="keyword">in</span> plain])</span><br><span class="line">skeys = get_sub_key(key)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始化置换</span></span><br><span class="line">block = IP(plain)</span><br><span class="line"></span><br><span class="line">L, R = block[:<span class="number">32</span>], block[<span class="number">32</span>:]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">    tpR = R[:]</span><br><span class="line">    R = F(i, R, skeys)</span><br><span class="line">    R = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x, y: x ^ y, R, L))</span><br><span class="line">    L = tpR</span><br><span class="line"><span class="comment"># 合并左右部分</span></span><br><span class="line">block = R + L</span><br><span class="line"><span class="comment"># 逆初始化操作</span></span><br><span class="line">block = FP(block)</span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">enc = <span class="built_in">bytes</span>([<span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>,block[i*<span class="number">8</span>:(i+<span class="number">1</span>)*<span class="number">8</span>])),<span class="number">2</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)])</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(enc)</span><br></pre></td></tr></table></figure>

<h3 id="封装库实现"><a href="#封装库实现" class="headerlink" title="封装库实现"></a>封装库实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> DES</span><br><span class="line">des = DES.new(<span class="string">b&#x27;12345678&#x27;</span>, DES.MODE_ECB)</span><br><span class="line"><span class="built_in">print</span>(des.encrypt(<span class="string">b&#x27;12345678&#x27;</span>))</span><br><span class="line">m = des.encrypt(<span class="string">b&#x27;12345678&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(des.decrypt(m))</span><br></pre></td></tr></table></figure>

<h2 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h2><h3 id="特点-1"><a href="#特点-1" class="headerlink" title="特点"></a>特点</h3><ol>
<li>输入：128 比特。</li>
<li>输出：128 比特。</li>
<li>SPN 网络结构。</li>
</ol>
<a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/f60151970f.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/f60151970f.png"  class="" lazyload></a>

<h3 id="与DES的注意点"><a href="#与DES的注意点" class="headerlink" title="与DES的注意点"></a>与DES的注意点</h3><ol>
<li>每一刻从64位变成128位</li>
<li>AES采用的的SPN网络结构与Feistel相比，可以加密整个块，并且解密必须是对加密的逆运算</li>
<li>SPN全称为<code>Substitution-permutation network</code>即代换-置换网络，简单的说就是会对块进行替换，置换等多重迭代操作。</li>
</ol>
<h3 id="迭代过程"><a href="#迭代过程" class="headerlink" title="迭代过程"></a>迭代过程</h3><ol>
<li><strong>AddRoundKey轮密钥加</strong><a class="simple-lightbox" href="/2023/07/20/Crypto_CTF/image-20230802155225058.png"><img   src="/images/loading.svg" data-src="/2023/07/20/Crypto_CTF/image-20230802155225058.png"  class="" lazyload></a></li>
<li><strong>SubBytes字节替换</strong><br>这里引入一个S盒，然后进行S盒替换</li>
<li><strong>ShiftRows行位移变换</strong><br>这也是一次扩散处理，达到雪崩效应（雪崩效应是指当输入发生最微小的改变（例如，反转一个二进制位）时，也会导致输出的不可区分性改变，即扩大错误防止攻击者找到不同明密文之间的关系）。</li>
<li><strong>MixColumns列混合变换</strong><br>也是扩散操作</li>
<li><strong>子密钥生成</strong></li>
</ol>
<h3 id="代码实现-1"><a href="#代码实现-1" class="headerlink" title="代码实现"></a>代码实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">r_con = (<span class="number">0x01</span>, <span class="number">0x02</span>, <span class="number">0x04</span>, <span class="number">0x08</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>,<span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>)</span><br><span class="line">s_box = (</span><br><span class="line">    <span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">    <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">    <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>,</span><br><span class="line">    <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>,</span><br><span class="line">    <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">    <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>,</span><br><span class="line">    <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>,</span><br><span class="line">    <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>,</span><br><span class="line">    <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>,</span><br><span class="line">    <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>,</span><br><span class="line">    <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>,</span><br><span class="line">    <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>,</span><br><span class="line">    <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>,</span><br><span class="line">    <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>,</span><br><span class="line">    <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>,</span><br><span class="line">    <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_bytes</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>(i^j <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(a, b))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_round_key</span>(<span class="params">s, k</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            s[i][j] ^= k[i][j]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sub_bytes</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            s[i][j] = s_box[s[i][j]]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shift_rows</span>(<span class="params">s</span>):</span><br><span class="line">    s[<span class="number">0</span>][<span class="number">1</span>], s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>], s[<span class="number">3</span>][<span class="number">1</span>] = s[<span class="number">1</span>][<span class="number">1</span>], s[<span class="number">2</span>][<span class="number">1</span>], s[<span class="number">3</span>][<span class="number">1</span>], s[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">    s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>], s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>] = s[<span class="number">2</span>][<span class="number">2</span>], s[<span class="number">3</span>][<span class="number">2</span>], s[<span class="number">0</span>][<span class="number">2</span>], s[<span class="number">1</span>][<span class="number">2</span>]</span><br><span class="line">    s[<span class="number">0</span>][<span class="number">3</span>], s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>], s[<span class="number">3</span>][<span class="number">3</span>] = s[<span class="number">3</span>][<span class="number">3</span>], s[<span class="number">0</span>][<span class="number">3</span>], s[<span class="number">1</span>][<span class="number">3</span>], s[<span class="number">2</span>][<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 参考 http://cs.ucsb.edu/~koc/cs178/projects/JT/aes.c</span></span><br><span class="line">xtime = <span class="keyword">lambda</span> a: (((a &lt;&lt; <span class="number">1</span>) ^ <span class="number">0x1B</span>) &amp; <span class="number">0xFF</span>) <span class="keyword">if</span> (a &amp; <span class="number">0x80</span>) <span class="keyword">else</span> (a &lt;&lt; <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mix_single_column</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="comment"># see Sec 4.1.2 in The Design of Rijndael</span></span><br><span class="line">    t = a[<span class="number">0</span>] ^ a[<span class="number">1</span>] ^ a[<span class="number">2</span>] ^ a[<span class="number">3</span>]</span><br><span class="line">    u = a[<span class="number">0</span>]</span><br><span class="line">    a[<span class="number">0</span>] ^= t ^ xtime(a[<span class="number">0</span>] ^ a[<span class="number">1</span>])</span><br><span class="line">    a[<span class="number">1</span>] ^= t ^ xtime(a[<span class="number">1</span>] ^ a[<span class="number">2</span>])</span><br><span class="line">    a[<span class="number">2</span>] ^= t ^ xtime(a[<span class="number">2</span>] ^ a[<span class="number">3</span>])</span><br><span class="line">    a[<span class="number">3</span>] ^= t ^ xtime(a[<span class="number">3</span>] ^ u)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mix_columns</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">        mix_single_column(s[i])</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_expand_key</span>(<span class="params">s</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        word = <span class="built_in">list</span>(s[-<span class="number">1</span>])  <span class="comment"># 取得最后一列</span></span><br><span class="line">        word.append(word.pop(<span class="number">0</span>)) <span class="comment"># 将首位移动到最后</span></span><br><span class="line">        word = [s_box[b] <span class="keyword">for</span> b <span class="keyword">in</span> word]  <span class="comment"># SubBytes操作</span></span><br><span class="line">        word[<span class="number">0</span>] ^= r_con[i]  <span class="comment"># 和异或表内数据异或</span></span><br><span class="line"></span><br><span class="line">        s.append(xor_bytes(word, s[-<span class="number">4</span>]))  <span class="comment"># 得到新的子密钥</span></span><br><span class="line">        s.append(xor_bytes(s[-<span class="number">1</span>], s[-<span class="number">4</span>]))  <span class="comment"># 因为直接在s中添加，所以本该和上一轮第二列异或的位置还是-4</span></span><br><span class="line">        s.append(xor_bytes(s[-<span class="number">1</span>], s[-<span class="number">4</span>]))</span><br><span class="line">        s.append(xor_bytes(s[-<span class="number">1</span>], s[-<span class="number">4</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [s[<span class="number">4</span>*i : <span class="number">4</span>*(i+<span class="number">1</span>)] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s) // <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bytes2matrix</span>(<span class="params">text</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Converts a 16-byte array into a 4x4 matrix.  &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">list</span>(text[i:i+<span class="number">4</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(text), <span class="number">4</span>)]</span><br><span class="line"></span><br><span class="line">key = <span class="string">b&#x27;1234567812345678&#x27;</span></span><br><span class="line">plain = <span class="string">b&#x27;1234567812345678&#x27;</span></span><br><span class="line">skeys = _expand_key(bytes2matrix(key))</span><br><span class="line">plain = bytes2matrix(plain)</span><br><span class="line"></span><br><span class="line">add_round_key(plain, skeys[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">    sub_bytes(plain)</span><br><span class="line">    shift_rows(plain)</span><br><span class="line">    mix_columns(plain)</span><br><span class="line">    add_round_key(plain, skeys[i])</span><br><span class="line"></span><br><span class="line">sub_bytes(plain)</span><br><span class="line">shift_rows(plain)</span><br><span class="line">add_round_key(plain, skeys[-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">enc = <span class="built_in">bytes</span>(plain[<span class="number">0</span>]+plain[<span class="number">1</span>]+plain[<span class="number">2</span>]+plain[<span class="number">3</span>])</span><br><span class="line"><span class="built_in">print</span>(enc)  <span class="comment"># b&#x27;m\xac\x1cV\xe7G\xfa\xe0:\xcf\x8ch\x91\xe4(\xe0&#x27;</span></span><br></pre></td></tr></table></figure>

<h3 id="封装库实现-1"><a href="#封装库实现-1" class="headerlink" title="封装库实现"></a>封装库实现</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">key = <span class="string">b&#x27;1234567812345678&#x27;</span></span><br><span class="line">plain = <span class="string">b&#x27;1234567812345678&#x27;</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line">cipher = AES.new(key, AES.MODE_ECB)</span><br><span class="line">enc = cipher.encrypt(plain)</span><br><span class="line"><span class="built_in">print</span>(enc)  </span><br></pre></td></tr></table></figure>




        </div>
        <div class="top-div">
          <ol class="top-box"><li class="top-box-item top-box-level-1"><a class="top-box-link" href="#HNCTF"><span class="top-box-text">HNCTF</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#baBAbaseSEse%EF%BC%88base%E5%AE%B6%E6%97%8F%EF%BC%89"><span class="top-box-text">baBAbaseSEse（base家族）</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#babyRsa%EF%BC%88%E5%9F%BA%E6%9C%ACRSA%EF%BC%89"><span class="top-box-text">babyRsa（基本RSA）</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#A-dictator%EF%BC%88%E5%87%AF%E6%92%92%E5%AF%86%E7%A0%81%EF%BC%89"><span class="top-box-text">A dictator（凯撒密码）</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#%E7%88%B1%E5%A6%83%EF%BC%88%E4%BB%BF%E5%B0%84%E5%AF%86%E7%A0%81%EF%BC%89"><span class="top-box-text">爱妃（仿射密码）</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#littleprince-%E5%90%8C%E4%BD%99%E6%96%B9%E7%A8%8B%EF%BC%8C%E4%B8%AD%E5%9B%BD%E5%89%A9%E4%BD%99%E5%AE%9A%E7%90%86"><span class="top-box-text">littleprince(同余方程，中国剩余定理)</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E6%8E%A9%E7%A0%81"><span class="top-box-text">掩码</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%85%B3%E4%BA%8E%E7%A7%BB%E4%BD%8D"><span class="top-box-text">关于移位</span></a></li></ol></li></ol></li><li class="top-box-item top-box-level-1"><a class="top-box-link" href="#RSA%E7%B3%BB%E5%88%97"><span class="top-box-text">RSA系列</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#RSA%E5%8E%9F%E7%90%86"><span class="top-box-text">RSA原理</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#RSA-Py%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="top-box-text">RSA Py代码实现</span></a></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#RSA%E7%B1%BB%E5%9E%8B"><span class="top-box-text">RSA类型</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#p-q%E8%BF%87%E5%B0%8F%E5%B7%AE%E5%80%BC%E5%B0%8F%E7%B1%BB%E5%9E%8B"><span class="top-box-text">p-q过小差值小类型</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E8%B4%B9%E9%A9%AC%E5%88%86%E8%A7%A3"><span class="top-box-text">费马分解</span></a></li></ol></li></ol></li><li class="top-box-item top-box-level-1"><a class="top-box-link" href="#%E5%AF%B9%E7%A7%B0%E5%AF%86%E7%A0%81%E7%B3%BB%E5%88%97"><span class="top-box-text">对称密码系列</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#DES"><span class="top-box-text">DES</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E7%89%B9%E7%82%B9"><span class="top-box-text">特点</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%8A%A0%E5%AF%86%E8%BF%87%E7%A8%8B"><span class="top-box-text">加密过程</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0"><span class="top-box-text">代码实现</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%B0%81%E8%A3%85%E5%BA%93%E5%AE%9E%E7%8E%B0"><span class="top-box-text">封装库实现</span></a></li></ol></li><li class="top-box-item top-box-level-2"><a class="top-box-link" href="#AES"><span class="top-box-text">AES</span></a><ol class="top-box-child"><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E7%89%B9%E7%82%B9-1"><span class="top-box-text">特点</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E4%B8%8EDES%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="top-box-text">与DES的注意点</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E8%BF%AD%E4%BB%A3%E8%BF%87%E7%A8%8B"><span class="top-box-text">迭代过程</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-1"><span class="top-box-text">代码实现</span></a></li><li class="top-box-item top-box-level-3"><a class="top-box-link" href="#%E5%B0%81%E8%A3%85%E5%BA%93%E5%AE%9E%E7%8E%B0-1"><span class="top-box-text">封装库实现</span></a></li></ol></li></ol></li></ol>
        </div>
      </div>
    </div>

    
      <div class="next-post">
        <a class="purple-link" href="/2023/07/19/Movfuscator%E6%B7%B7%E6%B7%86/">
          <h3 class="post-title">
            下一篇：Movfuscator混淆
          </h3>
        </a>
      </div>
    
  </div>










<footer>
<div class="site-footer">
  <div class="social-container">
    
      
        <a aria-label="跳转至github" href="https://github.com/Kidder1" target="_blank">
          <i class="icon icon-github"></i>
        </a>
      
    
      
    
      
    
      
    
      
    
  </div>
  
  
  
  
  
    
      <a href="https://beian.miit.gov.cn" target="_blank">陕ICP备2022004010号-1</a>
  
  
</div>
</footer>


      </div>
    </div>
    
<script id="hexo-configurations"> window.theme_config = {"image":{"lazyload_enable":true,"photo_zoom":"simple-lightbox"}}; window.is_post = true; </script>

<script src="/js/main.js"></script>






  <script src="/js/simple-lightbox.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {new SimpleLightbox('.post-detail .simple-lightbox', {fileExt: false,captionsData:'alt'});});</script></body>
</html>

